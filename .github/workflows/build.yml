name: Build & Test CI

on:  
    push:    
      branches: [ main ]  
    pull_request:    
      branches: [ main ]
jobs:  
    build:    
        runs-on: macos-latest 

        steps:    
        - uses: actions/checkout@v3    
        
        - name: Build for iOS      
          run: |
            set -o pipefail && env NSUnbufferedIO=YES \
              xcodebuild build-for-testing \
                -scheme "CoreUIKit" \
                -destination "platform=iOS Simulator,OS=latest,name=iPhone 12"    
        
        - name: Run iOS tests      
          run: |
            set -o pipefail && env NSUnbufferedIO=YES \
              xcodebuild test-without-building \
                -scheme "CoreUIKitTests" \
                -destination "platform=iOS Simulator,OS=latest,name=iPhone 12"    
        
        - name: Build documentation      
          run: |
            set -o pipefail && env NSUnbufferedIO=YES \
              xcodebuild docbuild \
                -derivedDataPath /tmp/doccgen \
                -scheme "CoreUIKit" \
                -destination "platform=iOS Simulator,OS=latest,name=iPhone 12"    
        
        - name: Generate documentation üìÑ     
          run: |
            set -o pipefail && env NSUnbufferedIO=YES \
              $(xcrun --find docc) process-archive \
                transform-for-static-hosting /tmp/doccgen/Build/Products/Debug-iphonesimulator/CoreUIKit.framework \
                --output-path docs \
                --hosting-base-path CoreUIKit
        
        - name: Upload Docs to doc folder üóÇÔ∏è
          uses: actions/upload-pages-artifact@v1
          with:
            path: 'docs'
        
        - name: Deploy docs to GitHub Pages üõ†Ô∏è
          id: deployment
          uses: actions/deploy-pages@v1
